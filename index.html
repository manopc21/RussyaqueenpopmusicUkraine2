<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="geolocation 'self'">
    <title>App - Ukrainian Stars Map</title>
    <link rel="icon" href="ICON.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="scripts.js"></script>
    <style>
        body {
            background-image: url('fundo.gif');
            background-size: cover;
            min-width: 800px;
            min-height: 675px;
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #23d3eb; /* Changed to red for Soviet theme */
        }

        .container {
            background: transparent;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3); /* Red shadow */
        }

        #map {
            height: 500px;
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #23d3eb; /* Red border */
        }

        .button-group button {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            flex: 1;
        }

        /* Red and gold colors for Soviet theme */
        #irinaBtn { background-color: #23d3eb; }
        #konstantinBtn { background-color: #ffd700; color: black; }

        .distance-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        input {
            padding: 8px;
            margin: 5px 0;
            width: 300px;
            background-color: #444;
            color: white;
            border: 1px solid #2ddfdf;
        }

        header {
            text-align: center;
            width: 100%;
            margin: 0 auto;
            padding: 20px 0;
        }

        header h1 {
            width: 50%;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
            color: #30def5;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background-size: cover;
            background-position: center;
            border-radius: 10px;
        }

        .about-content {
            background: transparent;
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
        }

        main {
            min-height: calc(100vh - 200px);
            padding-bottom: 100px;
        }

        footer {
            position: relative;
            bottom: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 0;
            margin-top: auto;
            clear: both;
            color: white;
            text-align: center;
        }

        .location-menu {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .dropdown-btn {
            background: #24b5ee;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            text-align: left;
        }

        .dropdown-content {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            max-height: 300px;
            overflow-y: auto;
            border-radius: 5px;
        }

        .dropdown-content.active {
            display: block;
        }

        .dropdown-content button {
            background: transparent;
            color: white;
            padding: 10px;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .dropdown-content button:hover {
            background: rgba(42, 247, 1, 0.3);
        }
    </style>
    <script src="locations.js"></script>
    <script src="countries.js"></script>
    <script src="americas.js"></script>
    <script src="asia.js"></script>
</head>
<body>
    <!-- Conte√∫do Principal -->
    <main class="about-content">
        <div class="wiki-container">
            <div class="map-container">
                <h2 style="text-align: center; margin-bottom: 20px; color: #23d3eb;">
                    Distance to Birthplaces of Ukrainian Stars üåè
                </h2>
                <h2 style="text-align: center; margin-bottom: 20px; color: #23d3eb;">
                    üëë Iryna Volodymyrivna Ossaoulenko üëë Konstantin Ousaulenko üëë
                </h2>
                
                <!-- Menu de Pa√≠ses -->
                <div class="location-menu" style="margin-bottom: 15px;">
                    <select id="countrySelect" onchange="selectCountry(this.value)" style="width: 100%; padding: 10px; background: #cc0000; color: white; border: none; border-radius: 5px;">
                        <option value="">Select your nation.</option>
                    </select>
                </div>

                <button onclick="getLocation()" style="width: 100%; margin-bottom: 15px;">üìç My Location</button>

                <div class="button-group">
                    <button id="irinaBtn" onclick="focusMember('Irina Osauilenko')">Iryna Volodymyrivna Ossaoulenko</button>
                    <button id="konstantinBtn" onclick="focusMember('Konstantin Osaulenko')">Konstantin Ossaoulenko</button>
                </div>

                <div id="map"></div>
                <div id="distances"></div>
            </div>
        </div>
    </main>

    <!-- Rodap√© -->
    <footer>
        <p>&copy; 2026 Ukrainian Stars Tribute</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        let map;
        let userMarker;
        const memberLayers = [];
        let currentUserCoords = null;

        const UKStarsBirthplaces = {
            " üëë QUEEN Iryna Volodymyrivna Ossaoulenko": { 
                lat: 50.4501, lng: 30.5234,
                info: "üé§ Kyiv, Ukrainian SSR, USSR (nascida em 9 de junho de 1968 como Irina Vladimirovna Poryvai)"
            },
            " üëë KING Konstantin Ossaoulenko": { 
                lat: 50.4501, lng: 30.5234,
                info: "üé§ Kyiv, Ukrainian SSR, USSR (nascido em 20 de Dezembro de 1961)"
            }
        };

        function initMap() {
            map = L.map('map').setView([50.4501, 30.5234], 3);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Raio da Terra em km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * 
                Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
                
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function plotLines(userLat, userLon) {
            currentUserCoords = { lat: userLat, lng: userLon };
            
            if(userMarker) map.removeLayer(userMarker);
            memberLayers.forEach(layer => map.removeLayer(layer));
            memberLayers.length = 0;

            userMarker = L.marker([userLat, userLon], {
                icon: L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41]
                })
            }).addTo(map).bindPopup("Sua Localiza√ß√£o");

            const colors = ['#cc0000', '#ffd700'];
            let distancesHTML = '';

            Object.entries(UKStarsBirthplaces).forEach(([member, loc], index) => {
                const distance = calculateDistance(userLat, userLon, loc.lat, loc.lng);
                
                const line = L.polyline(
                    [[userLat, userLon], [loc.lat, loc.lng]], 
                    {color: colors[index], weight: 2}
                ).addTo(map);

                const memberMarker = L.marker([loc.lat, loc.lng], {
                    icon: L.icon({
                        iconUrl: index === 0 ? 
                            'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png' :
                            'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41]
                    })
                }).bindPopup(`
                    <b>${member}</b><br>
                    ${loc.info}<br>
                    üìè Dist√¢ncia: ${distance.toFixed(1)} km
                `);

                memberLayers.push(line, memberMarker);
                memberMarker.addTo(map);

                distancesHTML += `
                    <div class="distance-item" style="border-left: 5px solid ${colors[index]}">
                        <b>${member}</b><br>
                        ${loc.info}<br>
                        Dist√¢ncia: ${distance.toFixed(1)} km
                    </div>
                `;
            });

            document.getElementById('distances').innerHTML = distancesHTML;

            const bounds = L.latLngBounds([
                [userLat, userLon],
                ...Object.values(UKStarsBirthplaces).map(loc => [loc.lat, loc.lng])
            ]);
            map.fitBounds(bounds);
        }

        function focusMember(member) {
            if (!currentUserCoords) return;
            
            const loc = UKStarsBirthplaces[member];
            const distance = calculateDistance(
                currentUserCoords.lat,
                currentUserCoords.lng,
                loc.lat,
                loc.lng
            );

            map.setView([loc.lat, loc.lng], 7);
            alert(`${member}\n${loc.info}\nDist√¢ncia: ${distance.toFixed(1)} km`);
        }

        async function geocodeAddress() {
            const address = document.getElementById('address').value;
            if (!address) return alert("Digite um endere√ßo");

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
                const data = await response.json();
                
                if (data.length > 0) {
                    plotLines(parseFloat(data[0].lat), parseFloat(data[0].lon));
                }
            } catch (error) {
                alert("Erro ao geocodificar endere√ßo");
            }
        }

        function getLocation() {
            if ("geolocation" in navigator) {
                const options = {
                    enableHighAccuracy: true,
                    timeout: 30000,
                    maximumAge: 0
                };

                // Mostra mensagem de carregamento
                document.getElementById('distances').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p>Aguardando permiss√£o de localiza√ß√£o...</p>
                        <p style="font-size: 0.9em; color: #cc0000;">
                            Se solicitado, clique em "Permitir" para compartilhar sua localiza√ß√£o
                        </p>
                    </div>
                `;

                navigator.geolocation.getCurrentPosition(
                    // Sucesso
                    function(position) {
                        console.log("Localiza√ß√£o obtida:", position.coords);
                        plotLines(position.coords.latitude, position.coords.longitude);
                    },
                    // Erro
                    function(error) {
                        console.error("Erro de geolocaliza√ß√£o:", error);
                        let message = "";
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                message = `
                                    <div style="padding: 20px; background: rgba(255,0,0,0.1); border-radius: 10px;">
                                        <p><strong>Acesso √† localiza√ß√£o negado</strong></p>
                                        <p>Para usar esta fun√ß√£o:</p>
                                        <ol>
                                            <li>Clique no √≠cone üîí na barra de endere√ßo</li>
                                            <li>Selecione "Permiss√µes do site"</li>
                                            <li>Ative "Localiza√ß√£o"</li>
                                            <li>Recarregue a p√°gina</li>
                                        </ol>
                                    </div>
                                `;
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message = "N√£o foi poss√≠vel obter sua localiza√ß√£o. Verifique se o GPS est√° ativado.";
                                break;
                            case error.TIMEOUT:
                                message = "Tempo esgotado. Tente novamente.";
                                break;
                            default:
                                message = "Erro: " + error.message;
                        }
                        document.getElementById('distances').innerHTML = message;
                    },
                    options
                );
            } else {
                alert("Seu navegador n√£o suporta geolocaliza√ß√£o.");
            }
        }

        async function loadCountries() {
            const select = document.getElementById('countrySelect');
            select.innerHTML = '<option value="">Selecione um Pa√≠s</option>';
            
            // Ordena os pa√≠ses alfabeticamente
            Object.entries(countries)
                .sort((a, b) => a[0].localeCompare(b[0]))
                .forEach(([countryName, coords]) => {
                    const option = document.createElement('option');
                    option.value = countryName;
                    option.textContent = countryName;
                    select.appendChild(option);
                });
        }

        function selectCountry(countryName) {
            if (!countryName) return;
            
            const country = countries[countryName];
            if (!country) return;

            // Plota diretamente as coordenadas do pa√≠s selecionado
            plotLines(country.lat, country.lng);
            
            // Atualiza o texto do select para mostrar o pa√≠s selecionado
            document.getElementById('countrySelect').value = countryName;
        }

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            loadCountries();
        });
    </script>
</body>

</html>
